# TripMind 아키텍처 문서

## 1. 시스템 아키텍처

### 1.1 전체 구조

```
                    ┌────────────┐
                    │  Streamlit │ ◄────────────┐
                    └────┬───────┘              │
                         │ UI 요청               │
                         ▼                       │
                ┌─────────────────┐              │
                │  LangGraph DAG  │              │
                │ (에이전트 조합) │              │
                └─────────────────┘              │
                  ▲      ▲      ▲                │
      ┌──────────┘      │      └────────────┐    │
      │                 │                   │    │
┌────────────────┐ ┌──────────────────┐ ┌──────────────────┐
│ SearchAgent     │ │ ItineraryAgent    │ │ CalendarAgent     │
└────────────────┘ └──────────────────┘ └──────────────────┘
      │                 │                   │
      ▼                 ▼                   ▼
┌───────────────┐ ┌────────────────┐ ┌────────────────────┐
│ Kakao API     │ │ PromptTemplate │ │ Google Calendar API │
└───────────────┘ └────────────────┘ └────────────────────┘
```

### 1.2 레이어드 아키텍처

```
tripmind/
├── agents/          # 에이전트 계층 (LangGraph)
├── services/        # 서비스 계층 (비즈니스 로직)
├── clients/         # 외부 API 클라이언트
├── models/          # 데이터 모델 (Django ORM)
└── api/            # API 엔드포인트 (DRF)
```

## 2. 핵심 컴포넌트

### 2.1 에이전트 계층

- **Prompt Router Agent**: 사용자 입력 분석 및 적절한 에이전트로 라우팅
- **Conversation Agent**: 일반적인 대화 처리
- **Itinerary Agent**: 여행 일정 생성 및 관리
- **Place Search Agent**: 장소 검색 및 정보 제공
- **Calendar Agent**: 캘린더 연동 및 일정 관리
- **Sharing Agent**: 일정 공유 기능

### 2.2 서비스 계층

- **ItineraryService**: 여행 일정 관련 비즈니스 로직
- **PlaceSearchService**: 장소 검색 관련 비즈니스 로직
- **CalendarService**: 캘린더 관련 비즈니스 로직
- **SharingService**: 공유 관련 비즈니스 로직
- **SessionManageService**: 세션 관리

### 2.3 외부 API 클라이언트

- **KakaoPlaceClient**: 카카오 장소 검색 API
- **GoogleCalendarClient**: 구글 캘린더 API
- **ClaudeClient**: Anthropic Claude API
- **OllamaClient**: Ollama API

## 3. 데이터 흐름

### 3.1 사용자 요청 처리

1. 사용자 입력 → Streamlit UI
2. Prompt Router Agent가 의도 분석
3. 적절한 에이전트로 라우팅
4. 에이전트 처리 및 응답 생성
5. 스트리밍 방식으로 응답 전달

### 3.2 에이전트 간 통신

- LangGraph를 통한 상태 관리
- 메모리 체크포인팅
- 컨텍스트 전달

## 4. 확장성 고려사항

### 4.1 LLM 확장성

- 다중 LLM 지원 (Claude, Llama3)
- 모델별 프롬프트 템플릿 관리
- 의존성 주입을 통한 유연한 모델 교체

### 4.2 API 확장성

- 새로운 외부 API 추가 용이
- API 클라이언트 추상화
- 에러 처리 및 재시도 메커니즘

## 5. 보안 고려사항

### 5.1 API 키 관리

- 환경 변수를 통한 API 키 관리
- 서비스 계정 사용
- 키 로테이션 지원

### 5.2 데이터 보안

- 사용자 인증 및 권한 관리
- 입력 데이터 검증
- LLM 가드레일 적용

## 6. 장애 대응

### 6.1 에러 처리

- 구체적인 예외 타입 정의
- 에러 복구 메커니즘
- 로깅 및 모니터링

### 6.2 성능 최적화

- 캐싱 전략
- API 호출 최적화
- 스트리밍 응답 지연 최소화

## 7. 테스트 전략

### 7.1 단위 테스트

- 에이전트 테스트
- 서비스 테스트
- API 클라이언트 테스트

### 7.2 통합 테스트

- 전체 플로우 테스트
- 에이전트 간 통신 테스트
- 외부 API 연동 테스트

## 8. 모니터링 및 로깅

### 8.1 로깅

- LLM 응답 로깅
- API 호출 로깅
- 에러 로깅

### 8.2 모니터링

- 성능 메트릭
- 에러율 모니터링
- API 사용량 추적

## 9. 향후 개선 사항

### 9.1 기능 개선

- 다국어 지원
- 추가 공유 방식
- 고급 검색 필터

### 9.2 기술 개선

- 캐시 레이어 도입
- 비동기 처리 강화
- 마이크로서비스 분리 고려
